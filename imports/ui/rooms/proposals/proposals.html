<template name="detailProposals">
  {{#contentFor "headerTitle"}}
  <h1 class="title">{{_ "dda.proposal.proposal"}} : </h1>
  {{/contentFor}}

  {{#contentFor "headerButtonLeft"}}
  {{>ionNavBackButton}}
  {{/contentFor}}

  {{#contentFor "headerButtonRight"}}

  {{/contentFor}}

{{#if dataReady}}
  {{#ionView}}
  {{#ionContent}}

{{> Template.dynamic template="detailViewProposals" data=scope}}

  {{/ionContent}}
  {{/ionView}}
  {{else}}
{{> loading}}
{{/if}}
</template>

<template name="detailViewProposals">
  {{#with room}}
  {{#with proposal}}
  <div class="list card">

    {{> buttonsProposals _id=parentId scope=parentType roomId=idParentRoom proposalId=_id._str status=status isCreator=isCreator isAdmin=../../isAdmin}}

    <div class="item item-divider">
      {{title}}
    </div>
    <div class="item {{#if creatorProfile.profilThumbImageUrl}}item-avatar{{/if}}">
      {{#if creatorProfile.profilThumbImageUrl}}
      {{> imgDoc profilThumbImageUrl=creatorProfile.profilThumbImageUrl resized="80x80"}}
      {{/if}}
      <h2>
        {{_ 'author'}} : <a href="{{pathFor 'detailList' _id=creatorProfile._id._str scope='citoyens'}}" class="dark">{{creatorProfile.name}}</a>
      </h2>
    </div>
    {{> statusProposals status=status}}
    <div class="item item-text-wrap">
      <p>{{description}}</p>
    </div>
    {{#if arguments}}
    <div class="item item-divider">
      {{_ 'dda.proposal.argumentstitle'}}
    </div>
    <div class="item item-text-wrap">
      {{#markdown}}{{arguments}}{{/markdown}}
    </div>
    {{/if}}
  </div>

    {{#if equals status 'amendable'}}

    {{#if amendementActivatedBool}}
    <div class="list card">
      <div class="item item-divider">
        {{_ 'dda.proposal.amendments.title'}}
      </div>
    {{#if isNotEndAmendement}}
    <div class="button-bar bar-positive">
      <a href="{{pathFor 'amendementsAdd' _id=parentId scope=parentType roomId=idParentRoom proposalId=_id._str}}" class="button button-small">{{> ionIcon icon="plus"}}</a>
    </div>
    <div class="item item-text-wrap">
      <p>{{_ 'dda.proposal.amendments.text'}} <strong>{{formatAmendementDateEnd}}</strong>
       {{_ 'dda.proposal.amendments.endofamendments'}} <strong>{{livestamp amendementDateEnd}}</strong>
      {{_ 'dda.proposal.amendments.proposetext'}}</p>
    </div>
    {{/if}}
    <div class="item item-divider">
      {{_ 'dda.proposal.amendments.listofamendmentstemporarily'}}
    </div>
    {{> listAmendementsProposals _id=parentId scope=parentType roomId=idParentRoom proposalId=_id._str status=status isAdmin=../../isAdmin amendements=objectKeyArrayAmendements }}
    </div>
    {{else}}
    <div class="list">
    <div class="item">
      {{_ 'dda.proposal.amendments.amendmentsdeactivated'}}
    </div>
    </div>
    {{/if}}

    <div class="list">
    <a href="{{pathFor 'proposalsDetailComments' _id=parentId scope=parentType roomId=idParentRoom proposalId=_id._str}}" class="item">
      <i class="icon fa fa-balance-scale"></i> {{_ 'dda.debate'}} <span class="badge badge-balanced">{{commentsCount}}</span>
    </a>
    </div>

    {{else if equals status 'tovote'}}

    {{#if voteActivatedBool}}
    <div class="list card">
      <div class="item item-divider">
        {{_ 'dda.proposal.tovote.title'}}
      </div>
    {{#if isNotEndVote}}
    <div class="item item-text-wrap">
      <p>{{_ 'dda.proposal.tovote.text'}} <strong>{{formatVoteDateEnd}}</strong>
      {{_ 'dda.proposal.tovote.endofvotes'}} <strong>{{livestamp voteDateEnd}}</strong></p>
    </div>
    {{> votesProposals status=status votes=votesResultat}}
    {{/if}}
    <div class="item item-divider">
      {{_ 'dda.proposal.tovote.listofamendmentsvalidated'}} : {{majority}}%
    </div>
    {{> listAmendementsProposals _id=parentId scope=parentType roomId=idParentRoom proposalId=_id._str status=status isAdmin=../../isAdmin amendements=objectKeyArrayAmendements }}
    </div>
    {{else}}
    <div class="list">
    <div class="item">
      {{_ 'dda.proposal.tovote.votesdisabled'}}
    </div>
    </div>
    {{/if}}

    <div class="list">
    <a href="{{pathFor 'proposalsDetailComments' _id=parentId scope=parentType roomId=idParentRoom proposalId=_id._str}}" class="item">
      <i class="icon fa fa-balance-scale"></i> {{_ 'dda.debate'}} <span class="badge badge-balanced">{{commentsCount}}</span>
    </a>
    </div>

    {{else if equals status 'resolved'}}

    <div class="list card">
      <div class="item item-divider">
        {{_ 'dda.resolution.resolution'}}
      </div>
    <div class="item item-text-wrap">
      {{#if votesResultat.voteValid}}
      <p><i class="icon fa fa-bell"></i> {{{_ 'dda.resolution.adopted'}}}
       {{_ 'dda.resolution.endofvote'}} <strong>{{livestamp voteDateEnd}}</strong>
      </p>
      {{else}}
      <p><i class="icon fa fa-bell"></i> {{{_ 'dda.resolution.refused'}}}
       {{_ 'dda.resolution.endofvote'}} <strong>{{livestamp voteDateEnd}}</strong>
      </p>
      {{/if}}

    </div>
    <a href="{{pathFor 'resolutionsDetail' _id=parentId scope=parentType roomId=idParentRoom resolutionId=_id._str}}" class="item"><i class="fa fa-chevron-right"></i> {{_ 'dda.resolution.showresolution'}}</a>
      <div class="item item-divider">
        {{_ 'dda.resolution.resultstitle'}}
      </div>
    {{> votesProposals status=status votes=votesResultat}}
    <div class="item item-divider">
      {{_ 'dda.proposal.tovote.listofamendmentsvalidated'}} : {{majority}}%
    </div>
    {{> listAmendementsProposals _id=parentId scope=parentType roomId=idParentRoom proposalId=_id._str status=status isAdmin=../../isAdmin amendements=objectKeyArrayAmendements }}
    <a href="{{pathFor 'proposalsDetailComments' _id=parentId scope=parentType roomId=idParentRoom proposalId=_id._str}}" class="item">
      <i class="icon fa fa-balance-scale"></i> DÃ©bat <span class="badge badge-balanced">{{commentsCount}}</span>
    </a>
    </div>

    {{else if equals status 'closed'}}

    {{/if}}

{{/with}}
{{/with}}
</template>

<template name="buttonsProposals">
{{#if equals status 'amendable'}}
{{#if isAdmin}}
<div class="button-bar bar-positive">
  <a href="{{pathFor 'proposalsEdit' _id=_id scope=scope roomId=roomId proposalId=proposalId}}" class="button button-small"><i class="fa fa-pencil"></i></a>
  <button class="button button-small action-proposal-js" data-action="disabled"><i class="fa fa-times"></i> {{_ "dda.proposal.buttons.disable"}}</button>
  <button class="button button-small action-proposal-js" data-action="closed"><i class="fa fa-trash"></i> {{_ "dda.proposal.buttons.close"}}</button>
</div>
{{else if isCreator}}
<div class="button-bar bar-positive">
  <a href="{{pathFor 'proposalsEdit' _id=_id scope=scope roomId=roomId proposalId=proposalId}}" class="button button-small"><i class="fa fa-pencil"></i></a>
  <button class="button button-small action-proposal-js" data-action="disabled"><i class="fa fa-times"></i> {{_ "dda.proposal.buttons.disable"}}</button>
  <button class="button button-small action-proposal-js" data-action="closed"><i class="fa fa-trash"></i> {{_ "dda.proposal.buttons.close"}}</button>
</div>
{{/if}}
{{else if equals status 'tovote'}}
{{#if isAdmin}}
<div class="button-bar bar-positive">
  <a href="{{pathFor 'proposalsEdit' _id=_id scope=scope roomId=roomId proposalId=proposalId}}" class="button button-small"><i class="fa fa-pencil"></i></a>
  <button class="button button-small action-proposal-js" data-action="disabled"><i class="fa fa-times"></i> {{_ "dda.proposal.buttons.disable"}}</button>
  <button class="button button-small action-proposal-js" data-action="closed"><i class="fa fa-trash"></i> {{_ "dda.proposal.buttons.close"}}</button>
</div>
{{else if isCreator}}
<div class="button-bar bar-positive">
  <a href="{{pathFor 'proposalsEdit' _id=_id scope=scope roomId=roomId proposalId=proposalId}}" class="button button-small"><i class="fa fa-pencil"></i></a>
  <button class="button button-small action-proposal-js" data-action="disabled"><i class="fa fa-times"></i> {{_ "dda.proposal.buttons.disable"}}</button>
  <button class="button button-small action-proposal-js" data-action="closed"><i class="fa fa-trash"></i> {{_ "dda.proposal.buttons.close"}}</button>
</div>
{{/if}}
{{else if equals status 'resolved'}}

{{else if equals status 'disabled'}}
{{#if isAdmin}}
<div class="button-bar bar-positive">
  <a href="{{pathFor 'proposalsEdit' _id=_id scope=scope roomId=roomId proposalId=proposalId}}" class="button button-small"><i class="fa fa-pencil"></i></a>
  <button class="button button-small action-proposal-js" data-action="amendable"><i class="fa fa-pencil"></i> {{_ "dda.proposal.buttons.backtoamendments"}}</button>
  <button class="button button-small action-proposal-js" data-action="tovote"><i class="fa fa-gavel"></i> {{_ "dda.proposal.buttons.openthevotes"}}</button>
  <button class="button button-small action-proposal-js" data-action="closed"><i class="fa fa-trash"></i> {{_ "dda.proposal.buttons.close"}}</button>
</div>
{{else if isCreator}}
<div class="button-bar bar-positive">
  <a href="{{pathFor 'proposalsEdit' _id=_id scope=scope roomId=roomId proposalId=proposalId}}" class="button button-small"><i class="fa fa-pencil"></i></a>
  <button class="button button-small action-proposal-js" data-action="amendable"><i class="fa fa-pencil"></i> {{_ "dda.proposal.buttons.backtoamendments"}}</button>
  <button class="button button-small action-proposal-js" data-action="tovote"><i class="fa fa-gavel"></i> {{_ "dda.proposal.buttons.openthevotes"}}</button>
  <button class="button button-small action-proposal-js" data-action="closed"><i class="fa fa-trash"></i> {{_ "dda.proposal.buttons.close"}}</button>
</div>
{{/if}}
{{else if equals status 'closed'}}
{{#if isAdmin}}
<div class="button-bar bar-positive">
  <a href="{{pathFor 'proposalsEdit' _id=_id scope=scope roomId=roomId proposalId=proposalId}}" class="button button-small"><i class="fa fa-pencil"></i></a>
  <button class="button button-small action-proposal-js" data-action="disabled"><i class="fa fa-times"></i> {{_ "dda.proposal.buttons.disable"}}</button>
</div>
{{else if isCreator}}
<div class="button-bar bar-positive">
  <a href="{{pathFor 'proposalsEdit' _id=_id scope=scope roomId=roomId proposalId=proposalId}}" class="button button-small"><i class="fa fa-pencil"></i></a>
  <button class="button button-small action-proposal-js" data-action="disabled"><i class="fa fa-times"></i> {{_ "dda.proposal.buttons.disable"}}</button>
</div>
{{/if}}
{{/if}}
</template>

<template name="statusProposals">
{{#if equals status 'amendable'}}
<div class="item">
  <strong>{{_ 'dda.proposal.status.amendable'}}</strong>	> {{_ 'dda.proposal.status.tovote'}}	> {{_ 'dda.proposal.status.closed'}}
</div>
{{else if equals status 'tovote'}}
<div class="item">
  {{_ 'dda.proposal.status.amendable'}}	> <strong>{{_ 'dda.proposal.status.tovote'}}</strong>	> {{_ 'dda.proposal.status.closed'}}
</div>
{{else if equals status 'resolved'}}
<div class="item">
  {{_ 'dda.proposal.status.amendable'}}	> {{_ 'dda.proposal.status.tovote'}}	> <strong>{{_ 'dda.proposal.status.resolved'}}</strong>
</div>
{{else if equals status 'disabled'}}
<div class="item">
  {{_ 'dda.proposal.status.amendable'}}	> <strong>{{_ 'dda.proposal.status.disabled'}}</strong> > {{_ 'dda.proposal.status.closed'}}
</div>
{{else if equals status 'closed'}}
<div class="item">
  {{_ 'dda.proposal.status.amendable'}}{{_ 'dda.proposal.status.amendable'}}	> {{_ 'dda.proposal.status.tovote'}}	> <strong>{{_ 'dda.proposal.status.closed'}}</strong>
</div>
{{/if}}
</template>

<template name="listAmendementsProposals">
{{#each amendement in amendements}}
{{> itemAmendementsProposals _id=_id scope=scope roomId=roomId proposalId=proposalId status=status isAdmin=isAdmin amendement=amendement}}
{{else}}
<div class="item">
  {{_ 'dda.proposal.amendments.noamendments'}}
</div>
{{/each}}
</template>

<template name="itemAmendementsProposals">
  {{#if equals status 'amendable'}}
  {{#if isAdmin}}
  <div class="button-bar bar-positive">
    <a href="{{pathFor 'amendementsEdit' _id=_id scope=scope roomId=roomId proposalId=proposalId amendementId=amendement.idKey}}" class="button button-small"><i class="icon fa fa-pencil"></i></a>
    <button class="button button-small action-amendement-js"><i class="icon fa fa-trash"></i></button>
  </div>
  {{else if equals amendement.idUserAuthor currentUser._id}}
  <div class="button-bar bar-positive">
    <a href="{{pathFor 'amendementsEdit' _id=_id scope=scope roomId=roomId proposalId=proposalId amendementId=amendement.idKey}}" class="button button-small"><i class="icon fa fa-pencil"></i></a>
    <button class="button button-small action-amendement-js"><i class="icon fa fa-trash"></i></button>
  </div>
  {{/if}}
  <div class="item item-divider">
    nÂ°{{amendement.idKey}} {{_ amendement.typeAmdt}} {{> badgeAmendementsProposals status=status votes=amendement.votesObject}}
  </div>
  <div class="item item-text-wrap">
    <p>{{amendement.textAdd}}</p>
  </div>
  {{> votesAmendements status=status votes=amendement.votesObject amendementId=amendement.idKey}}
  {{else if equals status 'tovote'}}
  {{#if equals amendement.votesObject.voteValid true }}
  <div class="item item-divider">
    nÂ°{{amendement.idKey}} {{_ amendement.typeAmdt}} {{> badgeAmendementsProposals status=status votes=amendement.votesObject}}
  </div>
  <div class="item item-text-wrap">
    <p>{{amendement.textAdd}}</p>
  </div>
  {{/if}}
  {{/if}}
</template>

<template name="votesProposals">

    {{#if equals status 'tovote'}}
      <div class="item item-text-wrap">
    {{#if votes.voteStart}}
    {{#if votes.voteValid}}
    {{{_ 'dda.proposal.tovote.proposal_temporarily' context='validated'}}} Â· {{votes.totalVotes}} {{_ 'dda.proposal.tovote.voter' count=votes.totalVotes}}
    {{else}}
    {{{_ 'dda.proposal.tovote.proposal_temporarily' context='refused'}}} Â· {{votes.totalVotes}} {{_ 'dda.proposal.tovote.voter' count=votes.totalVotes}}
    {{/if}}
    {{else}}
    {{_ 'dda.proposal.tovote.bethefirsttovote'}}
    {{/if}}

      <p>{{#if votes.meVote}}
      <strong>{{_ 'dda.proposal.tovote.youvoted'}}
      {{#if votes.voteUp.meVoteUp}}
      <span class="balanced">{{_ 'dda.proposal.tovote.infavour'}}</span>
      {{else if votes.voteDown.meVoteDown}}
      <span class="assertive">{{_ 'dda.proposal.tovote.against'}}</span>
      {{else if votes.voteWhite.meVoteWhite}}
      <span class="dark">{{_ 'dda.proposal.tovote.blank'}}</span>
      {{else if votes.voteUncomplet.meVoteUncomplet}}
      <span class="energized">{{_ 'dda.proposal.tovote.incomplete'}}</span>
      {{/if}}
      </strong>
      {{else}}
      {{_ 'dda.proposal.tovote.youhavenotvotedyet'}}
      {{/if}}
      </p>
      {{#if ../voteCanChangeBool}}
    <p>{{_ 'dda.proposal.tovote.votecanchange'}}</p>
    {{else}}

    {{/if}}
    </div>

    {{#if ../voteCanChangeBool}}
    {{#transition in="zoomIn" out="bounceOut"}}
    {{#if votes.meVote}}
    <div class="button-bar bar-clear animated in out">
      {{#if votes.voteUp.meVoteUp}}
      <button class="button button-small button-balanced disabled">{{_ 'dda.proposal.tovote.infavour'}} ({{votes.voteUp.pourc}}%)</button>
      {{else}}
      <button class="button button-small button-balanced savevote-js" data-vote="up">{{_ 'dda.proposal.tovote.infavour'}} ({{votes.voteUp.pourc}}%)</button>
      {{/if}}
      {{#if votes.voteDown.meVoteDown}}
      <button class="button button-small button-assertive disabled">{{_ 'dda.proposal.tovote.against'}} ({{votes.voteDown.pourc}}%)</button>
      {{else}}
      <button class="button button-small button-assertive savevote-js" data-vote="down">{{_ 'dda.proposal.tovote.against'}} ({{votes.voteDown.pourc}}%)</button>
      {{/if}}
      {{#if votes.voteWhite.meVoteWhite}}
      <button class="button button-small button-stable disabled">{{_ 'dda.proposal.tovote.blank'}} ({{votes.voteWhite.pourc}}%)</button>
      {{else}}
      <button class="button button-small button-stable savevote-js" data-vote="white">{{_ 'dda.proposal.tovote.blank'}} ({{votes.voteWhite.pourc}}%)</button>
      {{/if}}
      {{#if votes.voteUncomplet.meVoteUncomplet}}
      <button class="button button-small button-energized disabled">{{_ 'dda.proposal.tovote.incomplete'}} ({{votes.voteUncomplet.pourc}}%)</button>
      {{else}}
      <button class="button button-small button-energized savevote-js" data-vote="uncomplet">{{_ 'dda.proposal.tovote.incomplete'}} ({{votes.voteUncomplet.pourc}}%)</button>
      {{/if}}
    </div>
    {{else}}
    <div class="button-bar bar-clear animated in out">
      <button class="button button-small button-balanced savevote-js" data-vote="up">{{_ 'dda.proposal.tovote.infavour'}} ({{votes.voteUp.pourc}}%)</button>
      <button class="button button-small button-assertive savevote-js" data-vote="down">{{_ 'dda.proposal.tovote.against'}} ({{votes.voteDown.pourc}}%)</button>
      <button class="button button-small button-stable savevote-js" data-vote="white">{{_ 'dda.proposal.tovote.blank'}} ({{votes.voteWhite.pourc}}%)</button>
      <button class="button button-small button-energized savevote-js" data-vote="uncomplet">{{_ 'dda.proposal.tovote.incomplete'}} ({{votes.voteUncomplet.pourc}}%)</button>
    </div>
    {{/if}}

    {{/transition}}
    {{else}}
    {{#if votes.meVote}}
    {{#transition in="zoomIn" out="bounceOut"}}
    <div class="row animated in out">
      <div class="col text-center balanced-bg">
        {{_ 'dda.proposal.tovote.infavour'}} <br>({{votes.voteUp.pourc}}%)
      </div>
      <div class="col text-center assertive-bg">
        {{_ 'dda.proposal.tovote.against'}} <br>({{votes.voteDown.pourc}}%)
      </div>
      <div class="col text-center stable-bg dark">
        {{_ 'dda.proposal.tovote.blank'}} <br>({{votes.voteWhite.pourc}}%)
      </div>
      <div class="col text-center energized-bg">
        {{_ 'dda.proposal.tovote.incomplete'}} <br>({{votes.voteUncomplet.pourc}}%)
      </div>
    </div>
    {{/transition}}
    {{else}}
    {{#transition in="zoomIn" out="bounceOut"}}
    <div class="button-bar bar-clear animated in out">
      <button class="button button-small button-balanced savevote-js" data-vote="up">{{_ 'dda.proposal.tovote.infavour'}} ({{votes.voteUp.pourc}}%)</button>
      <button class="button button-small button-assertive savevote-js" data-vote="down">{{_ 'dda.proposal.tovote.against'}} ({{votes.voteDown.pourc}}%)</button>
      <button class="button button-small button-stable savevote-js" data-vote="white">{{_ 'dda.proposal.tovote.blank'}} ({{votes.voteWhite.pourc}}%)</button>
      <button class="button button-small button-energized savevote-js" data-vote="uncomplet">{{_ 'dda.proposal.tovote.incomplete'}} ({{votes.voteUncomplet.pourc}}%)</button>
    </div>
    {{/transition}}
    {{/if}}
    {{/if}}


    <div class="row">
      <div class="col text-center">
        <i class="icon balanced fa fa-group"></i> {{votes.voteUp.nb}}
      </div>
      <div class="col text-center">
        <i class="icon assertive fa fa-group"></i> {{votes.voteDown.nb}}
      </div>
      <div class="col text-center">
        <i class="icon dark fa fa-group"></i> {{votes.voteWhite.nb}}
      </div>
      <div class="col text-center">
        <i class="icon energized fa fa-group"></i> {{votes.voteUncomplet.nb}}
      </div>
    </div>

    <div class="row">
      <div class="col text-left">
        <h5 style="font-size:11px;"><i class="fa fa-gavel"></i> {{_ 'dda.proposal.tovote.changeofvote'}} : {{#if ../voteCanChangeBool}}<span class="balanced">{{_ 'yes'}}</span>{{else}}<span class="assertive">{{_ 'no'}}</span>{{/if}}</h5>
        <h5 style="font-size:11px;"><i class="fa fa-user-secret"></i> {{_ 'dda.proposal.tovote.anonymousvote'}} : {{#if ../voteAnonymousBool}}<span class="balanced">{{_ 'yes'}}</span>{{else}}<span class="assertive">{{_ 'no'}}</span>{{/if}}</h5>
      </div>
      <div class="col text-right">
        <h5 style="font-size:11px;">{{_ 'dda.proposal.tovote.majorityrule'}} : {{../majority}}%</h5>
      </div>
    </div>
    {{else if equals status 'resolved'}}
      <div class="item item-text-wrap">
        {{#if votes.voteValid}}
        {{_ 'dda.proposal.tovote.proposal' context='validated'}} Â· {{votes.totalVotes}} {{_ 'dda.proposal.tovote.voter' count=votes.totalVotes}}
        {{else}}
        {{_ 'dda.proposal.tovote.proposal' context='refused'}} Â· {{votes.totalVotes}} {{_ 'dda.proposal.tovote.voter' count=votes.totalVotes}}
        {{/if}}

      <p>{{#if votes.meVote}}
        <strong>{{_ 'dda.proposal.tovote.youvoted'}}
        {{#if votes.voteUp.meVoteUp}}
        <span class="balanced">{{_ 'dda.proposal.tovote.infavour'}}</span>
        {{else if votes.voteDown.meVoteDown}}
        <span class="assertive">{{_ 'dda.proposal.tovote.against'}}</span>
        {{else if votes.voteWhite.meVoteWhite}}
        <span class="dark">{{_ 'dda.proposal.tovote.blank'}}</span>
        {{else if votes.voteUncomplet.meVoteUncomplet}}
        <span class="energized">{{_ 'dda.proposal.tovote.incomplete'}}</span>
        {{/if}}
        </strong>
      {{/if}}
      </p>

    </div>

    <div class="row">
      <div class="col text-center balanced-bg">
        {{_ 'dda.proposal.tovote.infavour'}} <br>({{votes.voteUp.pourc}}%)
      </div>
      <div class="col text-center assertive-bg">
        {{_ 'dda.proposal.tovote.against'}} <br>({{votes.voteDown.pourc}}%)
      </div>
      <div class="col text-center stable-bg dark">
        {{_ 'dda.proposal.tovote.blank'}} <br>({{votes.voteWhite.pourc}}%)
      </div>
      <div class="col text-center energized-bg">
        {{_ 'dda.proposal.tovote.incomplete'}} <br>({{votes.voteUncomplet.pourc}}%)
      </div>
    </div>

    <div class="row">
      <div class="col text-center">
        <i class="icon balanced fa fa-group"></i> {{votes.voteUp.nb}}
      </div>
      <div class="col text-center">
        <i class="icon assertive fa fa-group"></i> {{votes.voteDown.nb}}
      </div>
      <div class="col text-center">
        <i class="icon dark fa fa-group"></i> {{votes.voteWhite.nb}}
      </div>
      <div class="col text-center">
        <i class="icon energized fa fa-group"></i> {{votes.voteUncomplet.nb}}
      </div>
    </div>

    <div class="row">
      <div class="col text-left">
        <h5 style="font-size:11px;"><i class="fa fa-gavel"></i> {{_ 'dda.proposal.tovote.changeofvote'}}  : {{#if ../voteCanChangeBool}}<span class="balanced">{{_ 'yes'}}</span>{{else}}<span class="assertive">{{_ 'no'}}</span>{{/if}}</h5>
        <h5 style="font-size:11px;"><i class="fa fa-user-secret"></i> {{_ 'dda.proposal.tovote.anonymousvote'}}  : {{#if ../voteAnonymousBool}}<span class="balanced">{{_ 'yes'}}</span>{{else}}<span class="assertive">{{_ 'no'}}</span>{{/if}}</h5>
      </div>
      <div class="col text-right">
        <h5 style="font-size:11px;">{{_ 'dda.proposal.tovote.majorityrule'}} : {{../majority}}%</h5>
      </div>
    </div>
    {{/if}}

</template>


<template name="votesAmendements">
  <div class="item item-text-wrap">
  <p>{{#if votes.meVote}}
  <strong>{{_ 'dda.proposal.tovote.youvoted'}}
  {{#if votes.voteUp.meVoteUp}}
  <span class="balanced">{{_ 'dda.proposal.tovote.infavour'}}</span>
  {{else if votes.voteDown.meVoteDown}}
  <span class="assertive">{{_ 'dda.proposal.tovote.against'}}</span>
  {{else if votes.voteWhite.meVoteWhite}}
  <span class="dark">{{_ 'dda.proposal.tovote.blank'}}</span>
  {{/if}}
  </strong>
  {{else}}
  {{_ 'dda.proposal.tovote.youhavenotvotedyet'}}
  {{/if}}
  </p>
<p>{{_ 'dda.proposal.tovote.votecanchange'}}</p>
</div>

<div class="button-bar bar-clear">
  <button class="button button-small button-balanced savevote-js" data-vote="up">{{_ 'dda.proposal.tovote.infavour'}} ({{votes.voteUp.pourc}}%)</button>
  <button class="button button-small button-assertive savevote-js" data-vote="down">{{_ 'dda.proposal.tovote.against'}} ({{votes.voteDown.pourc}}%)</button>
  <button class="button button-small button-stable savevote-js" data-vote="white">{{_ 'dda.proposal.tovote.blank'}} ({{votes.voteWhite.pourc}}%)</button>
</div>

<div class="row">
  <div class="col text-center">
    <i class="icon balanced fa fa-group"></i> {{votes.voteUp.nb}}
  </div>
  <div class="col text-center">
    <i class="icon assertive fa fa-group"></i> {{votes.voteDown.nb}}
  </div>
  <div class="col text-center">
    <i class="icon dark fa fa-group"></i> {{votes.voteWhite.nb}}
  </div>
</div>

</template>

<template name="badgeAmendementsProposals">
  {{#if votes.voteStart}}
  {{#if votes.voteValid}}
<span class="badge badge-balanced">{{#if equals status 'amendable'}}{{_ 'dda.proposal.amendments.validated_temporarily'}}{{else if equals status 'tovote'}}{{_ 'dda.proposal.amendments.validated'}}{{/if}}</span>
{{else}}
<span class="badge badge-assertive">{{#if equals status 'amendable'}}{{_ 'dda.proposal.amendments.refused_temporarily'}}{{else if equals status 'tovote'}}{{_ 'dda.proposal.amendments.refused'}}{{/if}}</span>
{{/if}}
{{/if}}
</template>

<template name="proposalsAdd">
  {{#contentFor "headerButtonLeft"}}
  {{>ionNavBackButton}}
  {{/contentFor}}

  {{#contentFor "headerButtonRight"}}

  {{/contentFor}}

  {{#contentFor "headerTitle"}}
  <h1 class="title">{{_ "proposals"}}</h1>
  {{/contentFor}}

  {{#ionView}}
  {{#ionContent}}
  <div class="list" data-snap-ignore="true">
    <div class="item item-divider">
      {{_ "creating a new proposal"}}
    </div>
    <div class="item item-text-wrap">
      {{_ 'proposalFormInformation'}}
    </div>
    {{#if error}}
    <div class="card">
      <div class="item item-text-wrap animated shake homestead text-center">
        {{_ error}}
      </div>
    </div>
    {{/if}}
    {{#autoForm id="addProposal" schema=SchemasProposalsRest type="method" meteormethod="insertProposal" singleMethodArgument=true template="ionic" class="padding"}}
    {{> proposalsFields}}
    <div class="item">
      <div class="button-bar">
        <button type="submit" class="button button-dark">{{_ "create"}}</button>
      </div>
    </div>
    {{/autoForm}}
  </div>
  {{/ionContent}}
  {{/ionView}}
</template>


<template name="proposalsEdit">
  {{#contentFor "headerButtonLeft"}}
  {{>ionNavBackButton}}
  {{/contentFor}}

  {{#contentFor "headerButtonRight"}}

  {{/contentFor}}

  {{#contentFor "headerTitle"}}
  <h1 class="title">{{_ "proposals"}}</h1>
  {{/contentFor}}

{{#if dataReady}}
  {{#ionView}}
  {{#ionContent}}
  <div class="list" data-snap-ignore="true">
    <div class="item item-divider">
      {{_ "edit a proposal"}}
    </div>
    <div class="item item-text-wrap">
      {{_ 'proposalFormInformation'}}
    </div>
    {{#if error}}
    <div class="card">
      <div class="item item-text-wrap animated shake homestead text-center">
        {{_ error}}
      </div>
    </div>
    {{/if}}
    {{#autoForm id="editProposal" schema=SchemasProposalsRest type="method-update" meteormethod="updateProposal" doc=proposal singleMethodArgument=true template="ionic" class="padding"}}
    {{> proposalsFields}}
    <div class="item">
      <div class="button-bar">
        <button type="submit" class="button button-dark">{{_ "edit"}}</button>
      </div>
    </div>
    {{/autoForm}}
  </div>
  {{/ionContent}}
  {{/ionView}}
  {{else}}
  {{> loading}}
  {{/if}}
</template>

<template name="proposalsFields">
{{> afQuickField name='title'}}
{{> afQuickField name='description' label-type='stacked' rows=8}}
<div class="item item-text-wrap stable-bg">
  <i class='fa fa-info-circle'></i> {{_ 'schemas.proposalsrest.description.information'}}
</div>
{{> afQuickField name='arguments' label-type='stacked' rows=8}}
{{> afQuickField name='amendementActivated'}}
<div class="item item-text-wrap stable-bg">
  <i class='fa fa-info-circle'></i> {{_ 'schemas.proposalsrest.amendementActivated.information'}}
</div>
{{#if equalFieldValue 'amendementActivated' true}}
{{> afQuickField name='amendementDateEnd' type="datetime-local"}}
{{/if}}
{{> afQuickField name='voteDateEnd' type="datetime-local"}}
{{> afQuickField name='majority'}}
<div class="item item-text-wrap stable-bg">
  {{#if currentFieldValue 'majority'}}
  <i class='fa fa-info-circle'></i> {{{_ 'schemas.proposalsrest.majority.information' majority=(currentFieldValue 'majority')}}}
  {{else}}
  <i class='fa fa-info-circle'></i> {{{_ 'schemas.proposalsrest.majority.information' majority=majority}}}
  {{/if}}
</div>
{{> afQuickField name='voteAnonymous'}}
<div class="item item-text-wrap stable-bg">
  <i class='fa fa-info-circle'></i> {{_ 'schemas.proposalsrest.voteAnonymous.information'}}
</div>
{{> afQuickField name='voteCanChange'}}
<div class="item item-text-wrap stable-bg">
  <i class='fa fa-info-circle'></i> {{_ 'schemas.proposalsrest.voteCanChange.information'}}
</div>

{{> afQuickField name='tags'}}
{{> afQuickField name='urls'}}

</template>

<template name="amendementsAdd">
  {{#contentFor "headerButtonLeft"}}
  {{>ionNavBackButton}}
  {{/contentFor}}

  {{#contentFor "headerButtonRight"}}

  {{/contentFor}}

  {{#contentFor "headerTitle"}}
  <h1 class="title">{{_ "dda.proposal.amendments.title"}}</h1>
  {{/contentFor}}

  {{#ionView}}
  {{#ionContent}}
  <div class="list" data-snap-ignore="true">
    <div class="item item-divider">
      {{_ "creating a new amendment"}}
    </div>
    <div class="item item-text-wrap">
      {{_ 'amendmentFormInformation'}}
    </div>
    {{#if error}}
    <div class="card">
      <div class="item item-text-wrap animated shake homestead text-center">
        {{_ error}}
      </div>
    </div>
    {{/if}}
    {{#autoForm id="addAmendement" schema=BlockProposalsRest type="method" meteormethod="insertAmendement" singleMethodArgument=true template="ionic" class="padding"}}
    {{> afQuickField name='txtAmdt' label-type='stacked' rows=8}}
    <div class="item">
      <div class="button-bar">
        <button type="submit" class="button button-dark">{{_ "create"}}</button>
      </div>
    </div>
    {{/autoForm}}
  </div>
  {{/ionContent}}
  {{/ionView}}
</template>


<template name="amendementsEdit">
  {{#contentFor "headerButtonLeft"}}
  {{>ionNavBackButton}}
  {{/contentFor}}

  {{#contentFor "headerButtonRight"}}

  {{/contentFor}}

  {{#contentFor "headerTitle"}}
  <h1 class="title">{{_ "dda.proposal.amendments.title"}}</h1>
  {{/contentFor}}

{{#if dataReady}}
  {{#ionView}}
  {{#ionContent}}
  <div class="list" data-snap-ignore="true">
    <div class="item item-divider">
      {{_ "edit a amendment"}}
    </div>
    {{#if error}}
    <div class="card">
      <div class="item item-text-wrap animated shake homestead text-center">
        {{_ error}}
      </div>
    </div>
    {{/if}}
    {{#autoForm id="editAmendement" schema=BlockProposalsRest type="method-update" meteormethod="updateAmendement" doc=amendement singleMethodArgument=true template="ionic" class="padding"}}
    {{> afQuickField name='txtAmdt' label-type='stacked' rows=8}}
    <div class="item">
      <div class="button-bar">
        <button type="submit" class="button button-dark">{{_ "edit"}}</button>
      </div>
    </div>
    {{/autoForm}}
  </div>
  {{/ionContent}}
  {{/ionView}}
  {{else}}
  {{> loading}}
  {{/if}}
</template>
